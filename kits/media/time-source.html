
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>BTimeSource &#8212; The Haiku Book  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/haiku.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/code.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="BTimedEventQueue" href="timed-event-queue.html" />
    <link rel="prev" title="BTimeCode" href="time-code.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../../index.html">
          <span>API Documentation</span></a></h1>
        <h2 class="heading"><span>BTimeSource</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="time-code.html">BTimeCode</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="timed-event-queue.html">BTimedEventQueue</a>&#160;&#160;»
        </p>

      </div>
        
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">BTimeSource</a><ul>
<li><a class="reference internal" href="#constructor-and-destructor">Constructor and Destructor</a><ul>
<li><a class="reference internal" href="#_CPPv4N11BTimeSource11BTimeSourceEv">BTimeSource</a></li>
</ul>
</li>
<li><a class="reference internal" href="#member-functions">Member Functions</a><ul>
<li><a class="reference internal" href="#_CPPv4N11BTimeSource17BroadcastTimeWarpE9bigtime_t9bigtime_t">BroadcastTimeWarp</a></li>
<li><a class="reference internal" href="#_CPPv4N11BTimeSource15GetStartLatencyEP9bigtime_t">GetStartLatency</a></li>
<li><a class="reference internal" href="#_CPPv4N11BTimeSource7GetTimeEP9bigtime_tP9bigtime_tPf">GetTime</a></li>
<li><a class="reference internal" href="#_CPPv4N11BTimeSource13HandleMessageE5int32PKv6size_t">HandleMessage</a></li>
<li><a class="reference internal" href="#_CPPv4N11BTimeSource9IsRunningEv">IsRunning</a></li>
<li><a class="reference internal" href="#_CPPv4N11BTimeSource3NowEv">Now</a></li>
<li><a class="reference internal" href="#_CPPv4N11BTimeSource18PerformanceTimeForE9bigtime_t">PerformanceTimeFor</a></li>
<li><a class="reference internal" href="#_CPPv4N11BTimeSource11PublishTimeE9bigtime_t9bigtime_tf">PublishTime</a></li>
<li><a class="reference internal" href="#_CPPv4N11BTimeSource8RealTimeEv">RealTime</a></li>
<li><a class="reference internal" href="#_CPPv4N11BTimeSource4SeekE9bigtime_t9bigtime_t">Seek</a></li>
<li><a class="reference internal" href="#_CPPv4N11BTimeSource11SendRunModeE8run_mode">SendRunMode</a></li>
<li><a class="reference internal" href="#_CPPv4N11BTimeSource10SetRunModeE8run_mode">SetRunMode</a></li>
<li><a class="reference internal" href="#_CPPv4N11BTimeSource11SnoozeUntilE9bigtime_t9bigtime_tb">SnoozeUntil</a></li>
<li><a class="reference internal" href="#_CPPv4N11BTimeSource5StartE9bigtime_t">Start</a></li>
<li><a class="reference internal" href="#_CPPv4N11BTimeSource4StopE9bigtime_t">Stop</a></li>
<li><a class="reference internal" href="#_CPPv4N11BTimeSource12TimeSourceOpERK19time_source_op_infoPv">TimeSourceOp</a></li>
</ul>
</li>
<li><a class="reference internal" href="#constants">Constants</a><ul>
<li><a class="reference internal" href="#time-source-op">time_source_op</a></li>
</ul>
</li>
<li><a class="reference internal" href="#defined-types">Defined Types</a><ul>
<li><a class="reference internal" href="#time-source-op-info">time_source_op_info</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>

        </div>
      </div>
          <div class="bodywrapper">
      <div class="content" role="main">
        
  <section id="btimesource">
<h1 id="CPPv411BTimeSource">BTimeSource<a class="headerlink" href="#btimesource" title="Permalink to this heading">¶</a></h1>
<section id="constructor-and-destructor">
<h2>Constructor and Destructor<a class="headerlink" href="#constructor-and-destructor" title="Permalink to this heading">¶</a></h2>
<section id="_CPPv4N11BTimeSource11BTimeSourceEv">
</section>
<h3>
BTimeSource()</h3><pre style="background: #f3f3f3; line-height: 2em"><span class="sig-prename descclassname"><a class="reference internal" href="#_CPPv4N11BTimeSource11BTimeSourceEv" title="BTimeSource::BTimeSource"><span class="n">BTimeSource</span></a><span class="p">::</span></span><span class="n">BTimeSource</span><span class="sig-paren">(</span><span class="sig-paren">)</span></pre><p>The standard <span class="hclass">BTimeSource</span> constructor. You should never directly
instantiate a <span class="hclass">BTimeSource</span>; instead, you should create a node
class derived from <span class="hclass">BTimeSource</span> (and possibly other
<a class="reference internal" href="media-node.html#_CPPv410BMediaNode" title="BMediaNode"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">BMediaNode</span></code></a>-derived classes as well) and use the
<a class="reference internal" href="media-roster.html#_CPPv412BMediaRoster" title="BMediaRoster"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">BMediaRoster</span></code></a> to instantiate the node as desired.</p>
</section>
<section id="member-functions">
<h2>Member Functions<a class="headerlink" href="#member-functions" title="Permalink to this heading">¶</a></h2>
<section id="_CPPv4N11BTimeSource17BroadcastTimeWarpE9bigtime_t9bigtime_t">
</section>
<h3>
BroadcastTimeWarp()</h3><pre style="background: #f3f3f3; line-height: 2em"><span class="kt">void</span><span class="w"> </span><span class="sig-prename descclassname"><a class="reference internal" href="#_CPPv411BTimeSource" title="BTimeSource"><span class="n">BTimeSource</span></a><span class="p">::</span></span><span class="n">BroadcastTimeWarp</span><span class="sig-paren">(</span><span class="n">bigtime_t</span><span class="w"> </span><span class="n sig-param">atRealTime</span>, <span class="n">bigtime_t</span><span class="w"> </span><span class="n sig-param">newPerformanceTime</span><span class="sig-paren">)</span></pre><p>Whenever time jumps suddenly (for instance, when a seek operation occurs),
call this function to inform all slaved nodes that time has jumped in a
discontinuous manner. You should also call this function if the time from
which your time source derives its time jumps.</p>
<p>At the real time specified by <span class="hparameter">atRealTime</span>, the performance time
will instantaneously jump to <span class="hparameter">newPerformanceTime</span>.</p>
<section id="_CPPv4N11BTimeSource15GetStartLatencyEP9bigtime_t">
</section>
<h3>
GetStartLatency()</h3><pre style="background: #f3f3f3; line-height: 2em"><a class="reference internal" href="../storage/the-node-monitor.html#_CPPv48status_t10BMessenger" title="status_t"><span class="n">status_t</span></a><span class="w"> </span><span class="sig-prename descclassname"><a class="reference internal" href="#_CPPv411BTimeSource" title="BTimeSource"><span class="n">BTimeSource</span></a><span class="p">::</span></span><span class="n">GetStartLatency</span><span class="sig-paren">(</span><span class="n">bigtime_t</span><span class="w"> </span><span class="p">*</span><span class="n sig-param">outLatency</span><span class="sig-paren">)</span></pre><p>Returns in <span class="hparameter">outLatency</span> the amount of time, in microseconds,
needed for the time source to start up, including the time needed to start
up any slaved nodes that are started.</p>
<table class="colwidths-auto docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p>Return Code</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_OK</span></code></p></td>
<td><p>The latency value was returned successfully.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_NO_INIT</span></code></p></td>
<td><p>The time source has not been initialized.</p></td>
</tr>
</tbody>
</table>
<section id="_CPPv4N11BTimeSource7GetTimeEP9bigtime_tP9bigtime_tPf">
</section>
<h3>
GetTime()</h3><pre style="background: #f3f3f3; line-height: 2em"><a class="reference internal" href="../storage/the-node-monitor.html#_CPPv48status_t10BMessenger" title="status_t"><span class="n">status_t</span></a><span class="w"> </span><span class="sig-prename descclassname"><a class="reference internal" href="#_CPPv411BTimeSource" title="BTimeSource"><span class="n">BTimeSource</span></a><span class="p">::</span></span><span class="n">GetTime</span><span class="sig-paren">(</span><span class="n">bigtime_t</span><span class="w"> </span><span class="p">*</span><span class="n sig-param">performanceTime</span>, <span class="n">bigtime_t</span><span class="w"> </span><span class="p">*</span><span class="n sig-param">realTime</span>, <span class="kt">float</span><span class="w"> </span><span class="p">*</span><span class="n sig-param">drift</span><span class="sig-paren">)</span></pre><p>Returns the most recently published time information for this time source;
this information specifies the performance time and real time of the last
published time stamp, as well as the <span class="hparameter">drift</span> value, which can be
used to interpolate the true current performance time, given a more
accurate real time, as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">bigtime_t</span><span class="w"> </span><span class="n">performanceTime</span><span class="p">;</span><span class="w"></span>
<span class="n">bigtime_t</span><span class="w"> </span><span class="n">realTime</span><span class="p">;</span><span class="w"></span>
<span class="kt">float</span><span class="w"> </span><span class="n">drift</span><span class="p">;</span><span class="w"></span>

<span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">GetTime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">performanceTime</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">realTime</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">drift</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">B_OK</span><span class="p">);</span><span class="w"></span>
<span class="n">performanceTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">performanceTime</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">RealTime</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">realTime</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">drift</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Note, however, that the resulting <span class="hparameter">performanceTime</span> is the same
value you would have gotten by calling <span class="hmethod">PerformanceTimeFor()</span>,
which you should use instead.</p>
<table class="colwidths-auto docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p>Return Code</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_OK</span></code></p></td>
<td><p>The returned information is accurate.</p></td>
</tr>
<tr class="row-odd"><td><p>Other values.</p></td>
<td><p>The returned information is unreliable.</p></td>
</tr>
</tbody>
</table>
<section id="_CPPv4N11BTimeSource13HandleMessageE5int32PKv6size_t">
</section>
<h3>
HandleMessage()</h3><pre style="background: #f3f3f3; line-height: 2em"><a class="reference internal" href="../storage/the-node-monitor.html#_CPPv48status_t10BMessenger" title="status_t"><span class="n">status_t</span></a><span class="w"> </span><span class="sig-prename descclassname"><a class="reference internal" href="#_CPPv411BTimeSource" title="BTimeSource"><span class="n">BTimeSource</span></a><span class="p">::</span></span><span class="n">HandleMessage</span><span class="sig-paren">(</span><span class="n">int32</span><span class="w"> </span><span class="n sig-param">code</span>, <span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">*</span><span class="n sig-param">message</span>, <span class="n">size_t</span><span class="w"> </span><span class="n sig-param">size</span><span class="sig-paren">)</span></pre><p>Given a <span class="hparameter">message</span> received on the control port, this function
dispatches the message to the appropriate <span class="hclass">BTimeSource</span> hook
function. If the message doesn’t correspond to a hook function, an
appropriate error be returned.</p>
<p>If your node derives from <span class="hclass">BTimeSource</span>, your implementation of
<span class="hmethod">HandleMessage()</span> should call all inherited forms of
<span class="hmethod">HandleMessage()</span>.</p>
<table class="colwidths-auto docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p>Return Code</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_OK</span></code></p></td>
<td><p>The message was dispatched.</p></td>
</tr>
<tr class="row-odd"><td><p>Other values.</p></td>
<td><p>The message couldn’t be dispatched, possibly because it doesn’t correspond
to a hook function.</p></td>
</tr>
</tbody>
</table>
<section id="_CPPv4N11BTimeSource9IsRunningEv">
</section>
<h3>
IsRunning()</h3><pre style="background: #f3f3f3; line-height: 2em"><span class="kt">bool</span><span class="w"> </span><span class="sig-prename descclassname"><a class="reference internal" href="#_CPPv411BTimeSource" title="BTimeSource"><span class="n">BTimeSource</span></a><span class="p">::</span></span><span class="n">IsRunning</span><span class="sig-paren">(</span><span class="sig-paren">)</span></pre><p>Returns <span class="cpp-expr sig sig-inline cpp"><span class="k">true</span></span> if the <span class="hclass">BTimeSource</span> is currently
progressing through time or <span class="cpp-expr sig sig-inline cpp"><span class="k">false</span></span> if it’s stopped.</p>
<section id="_CPPv4N11BTimeSource3NowEv">
</section>
<section id="_CPPv4N11BTimeSource18PerformanceTimeForE9bigtime_t">
</section>
<h3>
Now(), PerformanceTimeFor()</h3><pre style="background: #f3f3f3; line-height: 2em"><span class="n">bigtime_t</span><span class="w"> </span><span class="sig-prename descclassname"><a class="reference internal" href="#_CPPv411BTimeSource" title="BTimeSource"><span class="n">BTimeSource</span></a><span class="p">::</span></span><span class="n">Now</span><span class="sig-paren">(</span><span class="sig-paren">)</span></pre><pre style="background: #f3f3f3; line-height: 2em"><span class="n">bigtime_t</span><span class="w"> </span><span class="sig-prename descclassname"><a class="reference internal" href="#_CPPv411BTimeSource" title="BTimeSource"><span class="n">BTimeSource</span></a><span class="p">::</span></span><span class="n">PerformanceTimeFor</span><span class="sig-paren">(</span><span class="n">bigtime_t</span><span class="w"> </span><span class="n sig-param">realTime</span><span class="sig-paren">)</span><br /><span class="n">bigtime_t</span><span class="w"> </span><span class="sig-prename descclassname"><a class="reference internal" href="#_CPPv411BTimeSource" title="BTimeSource"><span class="n">BTimeSource</span></a><span class="p">::</span></span><span class="n">PerformanceTimeFor</span><span class="sig-paren">(</span><span class="n">bigtime_t</span><span class="w"> </span><span class="n sig-param">performanceTime</span>, <span class="n">bigtime_t</span><span class="w"> </span><span class="n sig-param">withLatency</span><span class="sig-paren">)</span></pre><p><span class="hmethod">Now()</span> returns an approximation of what the current performance
time is.</p>
<p><span class="hmethod">PerformanceTimeFor()</span> returns an estimate of the performance
time represented by the specified real time (as returned by
<a class="reference internal" href="#_CPPv4N11BTimeSource8RealTimeEv" title="BTimeSource::RealTime"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">BTimeSource::RealTime()</span></code></a>).</p>
<p><span class="hmethod">RealTimeFor()</span>, given a performance time, returns an
approximation of the corresponding real time, adjusted by the given
latency.</p>
<section id="_CPPv4N11BTimeSource11PublishTimeE9bigtime_t9bigtime_tf">
</section>
<h3>
PublishTime()</h3><pre style="background: #f3f3f3; line-height: 2em"><span class="kt">void</span><span class="w"> </span><span class="sig-prename descclassname"><a class="reference internal" href="#_CPPv411BTimeSource" title="BTimeSource"><span class="n">BTimeSource</span></a><span class="p">::</span></span><span class="n">PublishTime</span><span class="sig-paren">(</span><span class="n">bigtime_t</span><span class="w"> </span><span class="n sig-param">performanceTime</span>, <span class="n">bigtime_t</span><span class="w"> </span><span class="n sig-param">realTime</span>, <span class="kt">float</span><span class="w"> </span><span class="n sig-param">drift</span><span class="sig-paren">)</span></pre><p>While your time source is running, you should repeatedly call this
function in order to constantly refresh the mapping between real time and
performance time. When your time source is stopped, you should call this
function once with values of zero for all three arguments.</p>
<p>The arguments have the following meanings:</p>
<table class="colwidths-auto docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>performanceTime.</p></td>
<td><p>Is the precise current performance time.</p></td>
</tr>
<tr class="row-odd"><td><p>realTime.</p></td>
<td><p>Is the current real time.</p></td>
</tr>
<tr class="row-even"><td><p>drift.</p></td>
<td><p>Indicates the value which indicates the rate at which the performance time
changes compared to real time.</p></td>
</tr>
</tbody>
</table>
<p>The <span class="hparameter">drift</span> value makes it possible to interpolate intermediate
values. For instance, if playback of a video source is progressing at
normal speed, the <span class="hparameter">drift</span> value would be 1.0, indicating that
performance time and real time progress at the same rate.</p>
<p>However, if the movie is playing at half-speed, <span class="hparameter">drift</span> would be
0.5, so that for every one unit of real time that passes, only a half-unit
of performance time would pass. This information is used to compute times
without having to query the time source each time an update must occur.</p>
<p>The data furnished by this function (which you should try to call about 20
times a second, although variations in frequency are acceptable as long as
the drift value doesn’t change much) may be the only information the rest
of the world sees from your node.</p>
<section id="_CPPv4N11BTimeSource8RealTimeEv">
</section>
<h3>
RealTime()</h3><pre style="background: #f3f3f3; line-height: 2em"><span class="k">static</span><span class="w"> </span><span class="n">bigtime_t</span><span class="w"> </span><span class="sig-prename descclassname"><a class="reference internal" href="#_CPPv411BTimeSource" title="BTimeSource"><span class="n">BTimeSource</span></a><span class="p">::</span></span><span class="n">RealTime</span><span class="sig-paren">(</span><span class="sig-paren">)</span></pre><p>Returns the current absolute real time reference that all time sources
measure themselves against. This is the only call that you should rely upon
to obtain this value (don’t use the Kernel Kit’s <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">system_time()</span></code> function).</p>
<p>As of this time, <span class="hmethod">RealTime()</span> and <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">system_time()</span></code> do return the same value; however, you shouldn’t rely upon
this relationship. When doing media stuff, you should always use
<span class="hmethod">RealTime()</span>.</p>
<section id="_CPPv4N11BTimeSource4SeekE9bigtime_t9bigtime_t">
</section>
<h3>
Seek()</h3><pre style="background: #f3f3f3; line-height: 2em"><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="sig-prename descclassname"><a class="reference internal" href="#_CPPv411BTimeSource" title="BTimeSource"><span class="n">BTimeSource</span></a><span class="p">::</span></span><span class="n">Seek</span><span class="sig-paren">(</span><span class="n">bigtime_t</span><span class="w"> </span><span class="n sig-param">performanceTime</span>, <span class="n">bigtime_t</span><span class="w"> </span><span class="n sig-param">atRealTime</span><span class="sig-paren">)</span></pre><p>Implement this function to handle a seek request. When a
<span class="hclass">BTimeSource</span>’s performance time is adjusted, it needs to broadcast
the change to all nodes slaved to it; call <a class="reference internal" href="#_CPPv4N11BTimeSource17BroadcastTimeWarpE9bigtime_t9bigtime_t" title="BTimeSource::BroadcastTimeWarp"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">BroadcastTimeWarp()</span></code></a> to do this.</p>
<p>Be sure to queue at least one seek request, so seek operations can be
requested in advance. The seek request should occur at the real time
specified by <span class="hparameter">atRealTime</span>.</p>
<section id="_CPPv4N11BTimeSource11SendRunModeE8run_mode">
</section>
<h3>
SendRunMode()</h3><pre style="background: #f3f3f3; line-height: 2em"><span class="kt">void</span><span class="w"> </span><span class="sig-prename descclassname"><a class="reference internal" href="#_CPPv411BTimeSource" title="BTimeSource"><span class="n">BTimeSource</span></a><span class="p">::</span></span><span class="n">SendRunMode</span><span class="sig-paren">(</span><span class="n">run_mode</span><span class="w"> </span><span class="n sig-param">mode</span><span class="sig-paren">)</span></pre><p>This function transmits the specified mode to all the nodes slaved to this
node, so they know that their time source’s run mode has changed. This
function is called by <a class="reference internal" href="#_CPPv4N11BTimeSource10SetRunModeE8run_mode" title="BTimeSource::SetRunMode"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">SetRunMode()</span></code></a>;
it may or may not make sense to call it elsewhere, depending on your
<span class="hclass">BTimeSource</span> implementation.</p>
<section id="_CPPv4N11BTimeSource10SetRunModeE8run_mode">
</section>
<h3>
SetRunMode()</h3><pre style="background: #f3f3f3; line-height: 2em"><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="sig-prename descclassname"><a class="reference internal" href="#_CPPv411BTimeSource" title="BTimeSource"><span class="n">BTimeSource</span></a><span class="p">::</span></span><span class="n">SetRunMode</span><span class="sig-paren">(</span><span class="n">run_mode</span><span class="w"> </span><span class="n sig-param">mode</span><span class="sig-paren">)</span></pre><p>This hook function is called when someone requests that your node’s run
mode be changed. Be sure to call through to either
<code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">BMediaNode::SetRunMode()</span></code> or <span class="hmethod">BTimeSource::SetRunMode()</span>.</p>
<section id="_CPPv4N11BTimeSource11SnoozeUntilE9bigtime_t9bigtime_tb">
</section>
<h3>
SnoozeUntil()</h3><pre style="background: #f3f3f3; line-height: 2em"><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="sig-prename descclassname"><a class="reference internal" href="#_CPPv411BTimeSource" title="BTimeSource"><span class="n">BTimeSource</span></a><span class="p">::</span></span><span class="n">SnoozeUntil</span><span class="sig-paren">(</span><span class="n">bigtime_t</span><span class="w"> </span><span class="n sig-param">performanceTime</span>, <span class="n">bigtime_t</span><span class="w"> </span><span class="n sig-param">withLatency</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="m">0</span>, <span class="kt">bool</span><span class="w"> </span><span class="n sig-param">retrySignals</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">false</span><span class="sig-paren">)</span></pre><p>Waits until the specified <span class="hparameter">performanceTime</span> (specified in
performance time) arrives in real time. If <span class="hparameter">withLatency</span> is
non-zero, <span class="hmethod">SnoozeUntil()</span> waits until <span class="hparameter">withLatency</span>
microseconds (in real time) prior to the specified performance time; this
lets you have time for setup prior to starting some operation.</p>
<div class="note admonition">
<p class="admonition-title">Note</p>
<p>Because <span class="hparameter">performanceTime</span> is specified in performance time, and
<span class="hparameter">withLatency</span> is specified in real time, you can’t just subtract
<span class="hparameter">withLatency</span> microseconds from <span class="hparameter">performanceTime</span> and
snooze until that time, because <span class="hparameter">performanceTime</span> may be passing at
a rate faster than or slower than real time (if, for example, the time
source is running at double-speed).</p>
</div>
<p>If <span class="hparameter">retrySignals</span> is <span class="cpp-expr sig sig-inline cpp"><span class="k">false</span></span> (as is the default),
<span class="hmethod">SnoozeUntil()</span> returns <code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_INTERRUPTED</span></code> if it’s
interrupted by a signal before <span class="hparameter">performanceTime</span>; if
<span class="hparameter">retrySignals</span> is <span class="cpp-expr sig sig-inline cpp"><span class="k">true</span></span>, the function will go right back
to sleep and not return until the time has actually arrived.</p>
<table class="colwidths-auto docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p>Return Code</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_OK</span></code></p></td>
<td><p>No error; the snooze has completed without incident.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_MEDIA_TIME_SOURCE_STOPPED</span></code></p></td>
<td><p>The time source is stopped; snoozing on a stopped time source is a bad
thing.</p></td>
</tr>
</tbody>
</table>
<section id="_CPPv4N11BTimeSource5StartE9bigtime_t">
</section>
<h3>
Start()</h3><pre style="background: #f3f3f3; line-height: 2em"><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="sig-prename descclassname"><a class="reference internal" href="#_CPPv411BTimeSource" title="BTimeSource"><span class="n">BTimeSource</span></a><span class="p">::</span></span><span class="n">Start</span><span class="sig-paren">(</span><span class="n">bigtime_t</span><span class="w"> </span><span class="n sig-param">realTime</span><span class="sig-paren">)</span></pre><p>This function is called when someone wants the <span class="hclass">BTimeSource</span> to
begin running; the <span class="hparameter">realTime</span> argument indicates the real time at
which the time source should start. Implement the function to queue the
request as necessary.</p>
<p>Be sure to queue at least one start request, so that start requests can be
filed in advance.</p>
<div class="note admonition">
<p class="admonition-title">Note</p>
<p>A <span class="hclass">BTimeSource</span> measures start and stop times in real time, not in
performance time, because <span class="hclass">BTimeSource</span>s are the objects used to
perform the mapping between real time and performance time.</p>
</div>
<section id="_CPPv4N11BTimeSource4StopE9bigtime_t">
</section>
<h3>
Stop()</h3><pre style="background: #f3f3f3; line-height: 2em"><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="sig-prename descclassname"><a class="reference internal" href="#_CPPv411BTimeSource" title="BTimeSource"><span class="n">BTimeSource</span></a><span class="p">::</span></span><span class="n">Stop</span><span class="sig-paren">(</span><span class="n">bigtime_t</span><span class="w"> </span><span class="n sig-param">realTime</span><span class="sig-paren">)</span></pre><p><span class="hmethod">Stop()</span> is called when someone wants the <span class="hclass">BTimeSource</span>
to stop; the <span class="hparameter">realTime</span> argument indicates the real time at which
the time source should stop running. Implement the function to queue the
request.</p>
<p>Be sure to queue at least one stop request, so stop requests can be filed
in advance.</p>
<div class="note admonition">
<p class="admonition-title">Note</p>
<p>A <span class="hclass">BTimeSource</span> measures start and stop times in real time, not in
performance time, because <span class="hclass">BTimeSource</span>s are the objects used to
perform the mapping between real time and performance time.</p>
</div>
<section id="_CPPv4N11BTimeSource12TimeSourceOpERK19time_source_op_infoPv">
</section>
<h3>
TimeSourceOp()</h3><pre style="background: #f3f3f3; line-height: 2em"><span class="k">virtual</span><span class="w"> </span><a class="reference internal" href="../storage/the-node-monitor.html#_CPPv48status_t10BMessenger" title="status_t"><span class="n">status_t</span></a><span class="w"> </span><span class="sig-prename descclassname"><a class="reference internal" href="#_CPPv411BTimeSource" title="BTimeSource"><span class="n">BTimeSource</span></a><span class="p">::</span></span><span class="n">TimeSourceOp</span><span class="sig-paren">(</span><span class="k">const</span><span class="w"> </span><span class="n">time_source_op_info</span><span class="w"> </span><span class="p">&amp;</span><span class="n sig-param">op</span>, <span class="kt">void</span><span class="w"> </span><span class="p">*</span><span class="n sig-param">_reserved</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="m">0</span><span class="sig-paren">)</span></pre><p>This function is called by the <a class="reference internal" href="media-node.html#_CPPv4N10BMediaNode5StartE9bigtime_t" title="BMediaNode::Start"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">BMediaNode::Start()</span></code></a>,
<a class="reference internal" href="media-node.html#_CPPv4N10BMediaNode4StopE9bigtime_tb" title="BMediaNode::Stop"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">BMediaNode::Stop()</span></code></a>, and <a class="reference internal" href="media-node.html#_CPPv4N10BMediaNode4SeekE9bigtime_t9bigtime_t" title="BMediaNode::Seek"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">BMediaNode::Seek()</span></code></a> functions to
perform the requested activities.</p>
<p>You must implement this function to handle these requests.</p>
<p>Return <code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_OK</span></code> if the request was handled successfully;
otherwise, return an appropriate error code.</p>
</section>
<section id="constants">
<h2>Constants<a class="headerlink" href="#constants" title="Permalink to this heading">¶</a></h2>
<section id="time-source-op">
<h3>time_source_op<a class="headerlink" href="#time-source-op" title="Permalink to this heading">¶</a></h3>
<table class="colwidths-auto docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p>Constant</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_TIMESOURCE_START</span></code></p></td>
<td><p>Start the time source.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_TIMESOURCE_STOP</span></code></p></td>
<td><p>Stop the time source.</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_TIMESOURCE_STOP_IMMEDIATELY</span></code></p></td>
<td><p>Stop the time source immediately.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_TIMESOURCE_SEEK</span></code></p></td>
<td><p>Seek the time source.</p></td>
</tr>
</tbody>
</table>
<p>These constants identify the various operations <a class="reference internal" href="#_CPPv4N11BTimeSource12TimeSourceOpERK19time_source_op_infoPv" title="BTimeSource::TimeSourceOp"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">TimeSourceOp()</span></code></a> will be called upon to handle.</p>
</section>
</section>
<section id="defined-types">
<h2>Defined Types<a class="headerlink" href="#defined-types" title="Permalink to this heading">¶</a></h2>
<section id="time-source-op-info">
<h3>time_source_op_info<a class="headerlink" href="#time-source-op-info" title="Permalink to this heading">¶</a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">time_source_op_info</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="n">time_source_op</span><span class="w"> </span><span class="n">op</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">int32</span><span class="w"> </span><span class="n">_reserved1</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">bigtime_t</span><span class="w"> </span><span class="n">real_time</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">bigtime_t</span><span class="w"> </span><span class="n">performance_time</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">int32</span><span class="w"> </span><span class="n">_reserved2</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</pre></div>
</div>
<p>Describes a request to <a class="reference internal" href="#_CPPv4N11BTimeSource12TimeSourceOpERK19time_source_op_infoPv" title="BTimeSource::TimeSourceOp"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">TimeSourceOp()</span></code></a>.</p>
<table class="colwidths-auto docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>op</p></td>
<td><p>Indicates the operation to be performed.</p></td>
</tr>
<tr class="row-odd"><td><p>real_time</p></td>
<td><p>Indicates the time at which the request is to be filled (this is the
<span class="hparameter">atRealTime</span> argument passed to the <a class="reference internal" href="media-roster.html#_CPPv412BMediaRoster" title="BMediaRoster"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">BMediaRoster</span></code></a>
functions <a class="reference internal" href="media-roster.html#_CPPv4N12BMediaRoster14SeekTimeSourceERK10media_node9bigtime_t9bigtime_t" title="BMediaRoster::SeekTimeSource"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">SeekTimeSource()</span></code></a>,
<a class="reference internal" href="media-roster.html#_CPPv4N12BMediaRoster14StopTimeSourceEK10media_node9bigtime_tb" title="BMediaRoster::StopTimeSource"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">StopTimeSource()</span></code></a>, or
<a class="reference internal" href="media-roster.html#_CPPv4N12BMediaRoster15StartTimeSourceEK10media_node9bigtime_t" title="BMediaRoster::StartTimeSource"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">StartTimeSource()</span></code></a>).</p></td>
</tr>
<tr class="row-even"><td><p>performance_time</p></td>
<td><p>Is the <span class="hparameter">newPerformanceTime</span> argument passed to
<a class="reference internal" href="media-roster.html#_CPPv4N12BMediaRoster14SeekTimeSourceERK10media_node9bigtime_t9bigtime_t" title="BMediaRoster::SeekTimeSource"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">SeekTimeSource()</span></code></a>.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>


        <div class="clearer"></div>
      </div>
          </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="time-code.html">BTimeCode</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="timed-event-queue.html">BTimedEventQueue</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2023, Haiku, Inc..
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>

<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>BDirectory &#8212; The Haiku Book  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/haiku.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/code.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="BEntry" href="entry.html" />
    <link rel="prev" title="BAppFileInfo" href="app-file-info.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../../index.html">
          <span>API Documentation</span></a></h1>
        <h2 class="heading"><span>BDirectory</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="app-file-info.html">BAppFileInfo</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="entry.html">BEntry</a>&#160;&#160;»
        </p>

      </div>
        
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">BDirectory</a><ul>
<li><a class="reference internal" href="#retrieving-entries">Retrieving Entries</a></li>
<li><a class="reference internal" href="#creating-new-directories">Creating New Directories</a></li>
<li><a class="reference internal" href="#finding-a-directory">Finding a Directory</a></li>
<li><a class="reference internal" href="#node-monitoring-a-directory">Node Monitoring a Directory</a><ul>
<li><a class="reference internal" href="#b-entry-created">B_ENTRY_CREATED</a></li>
<li><a class="reference internal" href="#b-entry-moved">B_ENTRY_MOVED</a></li>
<li><a class="reference internal" href="#b-entry-removed">B_ENTRY_REMOVED</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>

        </div>
      </div>
          <div class="bodywrapper">
      <div class="content" role="main">
        
  <section id="bdirectory">
<h1 id="CPPv410BDirectory">BDirectory<a class="headerlink" href="#bdirectory" title="Permalink to this heading">¶</a></h1>
<p>A <a class="reference internal" href="../../kits/storage/directory.html#_CPPv410BDirectory" title="BDirectory"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">BDirectory</span></code></a> object gives you access to the contents of a
directory. A <a class="reference internal" href="../../kits/storage/directory.html#_CPPv410BDirectory" title="BDirectory"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">BDirectory</span></code></a>’s primary features are:</p>
<ul class="simple">
<li><p>It can iteratively retrieve the entries in the directory. The entries are
returned as <a class="reference internal" href="../../kits/storage/entry.html#_CPPv46BEntry" title="BEntry"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">BEntry</span></code></a> objects, <span class="htype">entry_ref</span>s, or
<span class="htype">dirent</span> structures (<a class="reference internal" href="../../kits/storage/directory.html#_CPPv4N10BDirectory12GetNextEntryEP6BEntryb" title="BDirectory::GetNextEntry"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">GetNextEntry()</span></code></a>, <a class="reference internal" href="../../kits/storage/directory.html#_CPPv4N10BDirectory10GetNextRefEP9entry_ref" title="BDirectory::GetNextRef"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">GetNextRef()</span></code></a>, <a class="reference internal" href="../../kits/storage/directory.html#_CPPv4N10BDirectory14GetNextDirentsEP6dirent6size_t5int32" title="BDirectory::GetNextDirents"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">GetNextDirents()</span></code></a>).</p></li>
<li><p>It can find a specific entry. You can ask if the entry exists
(<a class="reference internal" href="../../kits/storage/directory.html#_CPPv4NK10BDirectory8ContainsEPKc5int32" title="BDirectory::Contains"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">Contains()</span></code></a>), and you can retrieve the
entry as a <a class="reference internal" href="../../kits/storage/entry.html#_CPPv46BEntry" title="BEntry"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">BEntry</span></code></a> (<a class="reference internal" href="../../kits/storage/directory.html#_CPPv4NK10BDirectory9FindEntryEPKcP6BEntryb" title="BDirectory::FindEntry"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">FindEntry()</span></code></a>).</p></li>
<li><p>It can create new entries. Through the aptly named <a class="reference internal" href="../../kits/storage/directory.html#_CPPv4N10BDirectory10CreateFileEPKcP5BFileb" title="BDirectory::CreateFile"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">CreateFile()</span></code></a>, <a class="reference internal" href="../../kits/storage/directory.html#_CPPv4N10BDirectory15CreateDirectoryEPKcP10BDirectory" title="BDirectory::CreateDirectory"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">CreateDirectory()</span></code></a> and <a class="reference internal" href="../../kits/storage/directory.html#_CPPv4N10BDirectory13CreateSymLinkEPKcPKcP8BSymLink" title="BDirectory::CreateSymLink"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">CreateSymLink()</span></code></a> functions.</p></li>
</ul>
<p>Unlike the other <a class="reference internal" href="../../kits/storage/node.html#_CPPv45BNode" title="BNode"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">BNode</span></code></a> classes, a <a class="reference internal" href="../../kits/storage/directory.html#_CPPv410BDirectory" title="BDirectory"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">BDirectory</span></code></a>
knows its own entry (<a class="reference internal" href="../../kits/storage/directory.html#_CPPv4NK10BDirectory8GetEntryEP6BEntry" title="BDirectory::GetEntry"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">GetEntry()</span></code></a>), and
can be initialized with a <span class="htype">node_ref</span> structure.</p>
<section id="retrieving-entries">
<h2>Retrieving Entries<a class="headerlink" href="#retrieving-entries" title="Permalink to this heading">¶</a></h2>
<p>The <a class="reference internal" href="../../kits/storage/directory.html#_CPPv410BDirectory" title="BDirectory"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">BDirectory</span></code></a> functions that let you iterate over a
directory’s entries are inherited from <a class="reference internal" href="../../kits/storage/entry-list.html#_CPPv410BEntryList" title="BEntryList"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">BEntryList</span></code></a>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">status_t</span><span class="w"> </span><span class="nf">GetNextEntry</span><span class="p">(</span><span class="n">BEntry</span><span class="w"> </span><span class="o">*</span><span class="n">entry</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">traverse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span><span class="w"></span>
<span class="n">status_t</span><span class="w"> </span><span class="nf">GetNextRef</span><span class="p">(</span><span class="n">entry_ref</span><span class="w"> </span><span class="o">*</span><span class="n">ref</span><span class="p">);</span><span class="w"></span>
<span class="n">int32</span><span class="w"> </span><span class="n">GetNextDirents</span><span class="p">(</span><span class="n">dirent</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">length</span><span class="p">,</span><span class="w"></span>
<span class="w">                     </span><span class="n">int32</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">INT_MAX</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>For the basic story on these functions, see the <a class="reference internal" href="../../kits/storage/entry-list.html#_CPPv410BEntryList" title="BEntryList"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">BEntryList</span></code></a>
class and the function descriptions below. In addition to the info you’ll
find there, you should be aware of the following:</p>
<ul class="simple">
<li><p>Entries are returned in “directory order”. This is, roughly, the ASCII
order of their names.</p></li>
<li><p>Try not to alter the directory while you’re getting its entries. Entries
are delivered on demand. If you do something to change the contents of the
directory while you’re iterating through those contents (such as change the
name of the file “aaa” to “zzz”) you could end up seeing an entry more than
once (technically, you’ll see the same node under the guise of different
entries), or you could miss an entry.</p></li>
<li><p>Counting entries uses the same iterator that retrieves entries. You
mustn’t call <a class="reference internal" href="../../kits/storage/directory.html#_CPPv4N10BDirectory12CountEntriesEv" title="BDirectory::CountEntries"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">CountEntries()</span></code></a> while
you’re looping over a <span class="hmethod">GetNext…()</span> function.</p></li>
</ul>
</section>
<section id="creating-new-directories">
<h2>Creating New Directories<a class="headerlink" href="#creating-new-directories" title="Permalink to this heading">¶</a></h2>
<p>To create a new directory, you can use <a class="reference internal" href="../../kits/storage/directory.html#_CPPv410BDirectory" title="BDirectory"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">BDirectory</span></code></a>’s
<a class="reference internal" href="../../kits/storage/directory.html#_CPPv4N10BDirectory15CreateDirectoryEPKcP10BDirectory" title="BDirectory::CreateDirectory"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">CreateDirectory()</span></code></a> function. The
function creates a single new directory as identified by its argument. The
new directory will be a subdirectory of the invoked-upon
<a class="reference internal" href="../../kits/storage/directory.html#_CPPv410BDirectory" title="BDirectory"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">BDirectory</span></code></a>’s directory.</p>
<p>You can also create an entire path full of new directories through the
global <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">create_directory()</span></code> function. This
convenient function attempts to create all “missing” directories along the
path that you pass in.</p>
</section>
<section id="finding-a-directory">
<h2>Finding a Directory<a class="headerlink" href="#finding-a-directory" title="Permalink to this heading">¶</a></h2>
<p>The <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">find_directory()</span></code> function gives you the
pathnames for pre-defined directories. These directories, such as those
that store Be-supplied applications and user-defined preferences settings,
are represented by directory_which constants. These constants are not
strings; you can’t use them directly. You have to pass them through
<code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">find_directory()</span></code>.</p>
<p>Note that the <a class="reference internal" href="../../kits/storage/directory.html#_CPPv410BDirectory" title="BDirectory"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">BDirectory</span></code></a> class itself doesn’t let you find
directories on the basis of the <span class="xref std std-ref">directory_which</span> constants—you have
to use the <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">find_directory()</span></code> function (which
is documented at the end of this class description).</p>
</section>
<section id="node-monitoring-a-directory">
<h2>Node Monitoring a Directory<a class="headerlink" href="#node-monitoring-a-directory" title="Permalink to this heading">¶</a></h2>
<div class="note admonition">
<p class="admonition-title">Note</p>
<p>The following description is a brief, directory-specific view into the
Node Monitor. For the full story, see “<span class="xref std std-ref">The Node Monitor</span>” section of
this chapter.</p>
</div>
<p>You can monitor changes to the contents of a directory by passing a
<a class="reference internal" href="../../kits/storage/directory.html#_CPPv410BDirectory" title="BDirectory"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">BDirectory</span></code></a>’s <span class="htype">node_ref</span> and the
<code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_WATCH_DIRECTORY</span></code> flag to the Node Monitor’s
<code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">watch_node()</span></code> function. As with all invocations of
<code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">watch_node()</span></code>, you also have to pass a
<a class="reference internal" href="../../kits/application/messenger.html#_CPPv410BMessenger" title="BMessenger"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">BMessenger</span></code></a> (the “target”) that will receive the Node Monitor
notifications; here, we use <code class="xref cpp cpp-var docutils literal notranslate"><span class="pre">be_app_messenger</span></code>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">BDirectory</span><span class="w"> </span><span class="n">dir</span><span class="p">(</span><span class="s">&quot;/boot/home&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">node_ref</span><span class="w"> </span><span class="n">nref</span><span class="p">;</span><span class="w"></span>
<span class="n">status_t</span><span class="w"> </span><span class="n">err</span><span class="p">;</span><span class="w"></span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dir</span><span class="p">.</span><span class="n">InitCheck</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">B_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="n">dir</span><span class="p">.</span><span class="n">GetNodeRef</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nref</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">watch_node</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nref</span><span class="p">,</span><span class="w"> </span><span class="n">B_WATCH_DIRECTORY</span><span class="p">,</span><span class="w"> </span><span class="n">be_app_messenger</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">B_OK</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="cm">/* handle the error */</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The following changes to the monitored directory cause
<a class="reference internal" href="../../kits/application/message.html#_CPPv48BMessage" title="BMessage"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">BMessage</span></code></a>s to be sent to the target. The <span class="hparameter">what</span> field
for all Node Monitor messages is <code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_NODE_MONITOR</span></code>; the
<span class="hparameter">opcode</span> field (an integer code) describes the activity:</p>
<ul class="simple">
<li><p>An entry was created (<span class="hparameter">opcode</span> =
<a class="reference internal" href="../../kits/storage/the-node-monitor.html#_CPPv415B_ENTRY_CREATED" title="B_ENTRY_CREATED"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_ENTRY_CREATED</span></code></a>).</p></li>
<li><p>An entry was moved to a different name in the same directory
(<code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_ENTRY_RENAMED</span></code>).</p></li>
<li><p>An entry was from moved from this directory to a different directory, or
vice versa (<a class="reference internal" href="../../kits/storage/the-node-monitor.html#_CPPv413B_ENTRY_MOVED" title="B_ENTRY_MOVED"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_ENTRY_MOVED</span></code></a>).</p></li>
<li><p>An entry (and the node it represents) was deleted from the file system
(<a class="reference internal" href="../../kits/storage/the-node-monitor.html#_CPPv415B_ENTRY_REMOVED" title="B_ENTRY_REMOVED"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_ENTRY_REMOVED</span></code></a>).</p></li>
</ul>
<p>The <code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_WATCH_DIRECTORY</span></code> flag (by itself) doesn’t monitor
changes to the directory’s own entry. For example, if you change the name
of the directory that you’re monitoring, the target isn’t sent a message.
If you want a <a class="reference internal" href="../../kits/storage/directory.html#_CPPv410BDirectory" title="BDirectory"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">BDirectory</span></code></a> to watch changes to itself, you have
to throw in one of the other Node Monitor flags
(<code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_WATCH_NAME</span></code>, <code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_WATCH_STAT</span></code>, or
<code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_WATCH_ATTR</span></code>).</p>
<p>The other fields in the Node Monitor message describe the entry that
changed. The set of fields depends on the opcode (the following is a
summary of the list given in “<code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">Notification</span> <span class="pre">Messages</span></code>” in the Node Monitor
documentation):</p>
<section id="b-entry-created">
<h3>B_ENTRY_CREATED<a class="headerlink" href="#b-entry-created" title="Permalink to this heading">¶</a></h3>
<table class="colwidths-auto docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="hparameter">device</span></p></td>
<td><p><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_INT32_TYPE</span></code></p></td>
<td><p><span class="htype">dev_t</span> of the directory’s device.</p></td>
</tr>
<tr class="row-odd"><td><p><span class="hparameter">directory</span></p></td>
<td><p><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_INT64_TYPE</span></code></p></td>
<td><p><span class="htype">ino_t</span> (node number) of the directory.</p></td>
</tr>
<tr class="row-even"><td><p><span class="hparameter">node</span></p></td>
<td><p><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_INT64_TYPE</span></code></p></td>
<td><p><span class="htype">ino_t</span> of the new entry’s node.</p></td>
</tr>
<tr class="row-odd"><td><p><span class="hparameter">name</span></p></td>
<td><p><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_STRING_TYPE</span></code></p></td>
<td><p>The name of the new entry.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="b-entry-moved">
<h3>B_ENTRY_MOVED<a class="headerlink" href="#b-entry-moved" title="Permalink to this heading">¶</a></h3>
<p>The <span class="hparameter">device</span>, <span class="hparameter">node</span>, and <span class="hparameter">name</span> fields are the
same as for <a class="reference internal" href="../../kits/storage/the-node-monitor.html#_CPPv415B_ENTRY_CREATED" title="B_ENTRY_CREATED"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_ENTRY_CREATED</span></code></a>, plus…</p>
<table class="colwidths-auto docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="hparameter">from_directory</span></p></td>
<td><p><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_INT64_TYPE</span></code></p></td>
<td><p>The <span class="htype">ino_t</span> number of the old directory.</p></td>
</tr>
<tr class="row-odd"><td><p><span class="hparameter">to_directory</span></p></td>
<td><p><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_INT64_TYPE</span></code></p></td>
<td><p>The <span class="htype">ino_t</span> number of the new directory.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="b-entry-removed">
<h3>B_ENTRY_REMOVED<a class="headerlink" href="#b-entry-removed" title="Permalink to this heading">¶</a></h3>
<p>The <a class="reference internal" href="../../kits/storage/the-node-monitor.html#_CPPv415B_ENTRY_REMOVED" title="B_ENTRY_REMOVED"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_ENTRY_REMOVED</span></code></a> message takes the same form as
<a class="reference internal" href="../../kits/storage/the-node-monitor.html#_CPPv415B_ENTRY_CREATED" title="B_ENTRY_CREATED"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_ENTRY_CREATED</span></code></a>, but without the <span class="hparameter">name</span> field.
This, obviously, can be a problem—what good is it if you’re told that a
file has been removed, but you’re not told the file’s name? In some cases,
simply being told that a file has been removed actually is good enough: You
can simply re-read the contents of the directory.</p>
</section>
</section>
</section>


        <div class="clearer"></div>
      </div>
          </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="app-file-info.html">BAppFileInfo</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="entry.html">BEntry</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2023, Haiku, Inc..
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>
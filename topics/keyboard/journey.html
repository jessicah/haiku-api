
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Journey Of A Keystroke &#8212; The Haiku Book  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/haiku.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/code.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Key Codes" href="key-codes.html" />
    <link rel="prev" title="Introduction" href="introduction.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../../index.html">
          <span>API Documentation</span></a></h1>
        <h2 class="heading"><span>Journey Of A Keystroke</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="introduction.html">Introduction</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="key-codes.html">Key Codes</a>&#160;&#160;»
        </p>

      </div>
        
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Journey Of A Keystroke</a><ul>
<li><a class="reference internal" href="#step-1-the-input-server-add-on">Step 1: The Input Server Add-on</a></li>
<li><a class="reference internal" href="#step-2-the-application-server">Step 2: The Application Server</a></li>
<li><a class="reference internal" href="#step-3-the-active-window">Step 3: The Active Window</a></li>
<li><a class="reference internal" href="#step-4-the-focused-view">Step 4: The Focused View</a></li>
</ul>
</li>
</ul>

  </div>

        </div>
      </div>
          <div class="bodywrapper">
      <div class="content" role="main">
        
  <section id="journey-of-a-keystroke">
<h1 id="CPPv422Journey Of A Keystroke">Journey Of A Keystroke<a class="headerlink" href="#journey-of-a-keystroke" title="Permalink to this heading">¶</a></h1>
<p>When the user presses a key, a series of events is launched to handle that
action. Let’s follow the bits through the system after the user presses a
key on the keyboard.</p>
<section id="step-1-the-input-server-add-on">
<h2>Step 1: The Input Server Add-on<a class="headerlink" href="#step-1-the-input-server-add-on" title="Permalink to this heading">¶</a></h2>
<p>When the user presses a key on the keyboard, the entity responsible for
recognizing this action is the Input Server add-on for the keyboard device
on which the key was pressed. The add-on uses the current keymap (which it
has obtained by calling <span class="xref std std-ref">get_key_map()</span>) to map the keycode to the
character.</p>
<p>The add-on then constructs a <code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_KEY_DOWN</span></code> or
<code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_UNMAPPED_KEY_DOWN</span></code> <a class="reference internal" href="../../kits/application/message.html#_CPPv48BMessage" title="BMessage"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">BMessage</span></code></a>, containing
both the raw keycode and the actual characters generated by the key, and
sends the message to the Application Server by calling the
<a class="reference internal" href="../../kits/input/input-server-device.html#_CPPv4N18BInputServerDevice14EnqueueMessageEP8BMessage" title="BInputServerDevice::EnqueueMessage"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">BInputServerDevice::EnqueueMessage()</span></code></a> function.</p>
</section>
<section id="step-2-the-application-server">
<h2>Step 2: The Application Server<a class="headerlink" href="#step-2-the-application-server" title="Permalink to this heading">¶</a></h2>
<p>The Aplication Server receives the message from the Input Server add-on
and decides what to do with it. If the key pressed is something the
Application Server traps, like a workspace change keystroke, it gets
handled internally.</p>
<p>Otherwise, the Application server locates the active window and passes the
<a class="reference internal" href="../../kits/application/message.html#_CPPv48BMessage" title="BMessage"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">BMessage</span></code></a> along to its <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">BWindow::DispatchMessage()</span></code>
function.</p>
</section>
<section id="step-3-the-active-window">
<h2>Step 3: The Active Window<a class="headerlink" href="#step-3-the-active-window" title="Permalink to this heading">¶</a></h2>
<p>The <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">BWindow::DispatchMessage()</span></code> function receives the
<a class="reference internal" href="../../kits/application/message.html#_CPPv48BMessage" title="BMessage"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">BMessage</span></code></a> from the Application Server, and intercepts some keys
(like menu shortcuts and the <span class="hkey">Command</span>+<span class="hkey">W</span> close window
sequence). If it’s not a key the <a class="reference internal" href="../../kits/interface/window.html#_CPPv47BWindow" title="BWindow"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">BWindow</span></code></a> class (or derived
class) wants to intercept, <span class="hmethod">DispatchMessage()</span> passes the message
along to the currently focused view’s <a class="reference internal" href="../../kits/interface/view.html#_CPPv4N5BView15MessageReceivedEP8BMessage" title="BView::MessageReceived"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">BView::MessageReceived()</span></code></a>
function.</p>
</section>
<section id="step-4-the-focused-view">
<h2>Step 4: The Focused View<a class="headerlink" href="#step-4-the-focused-view" title="Permalink to this heading">¶</a></h2>
<p>The message finally arrives at the view that’s currently focused in the
active window. This view’s <a class="reference internal" href="../../kits/interface/view.html#_CPPv4N5BView15MessageReceivedEP8BMessage" title="BView::MessageReceived"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">MessageReceived()</span></code></a> function processes the keypress in whatever way
it wants to.</p>
<p>Likewise, when the key is released, a <code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_KEY_UP</span></code> or
<code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">B_UNMAPPED_KEY_UP</span></code> event is sent through this same route.</p>
</section>
</section>


        <div class="clearer"></div>
      </div>
          </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="introduction.html">Introduction</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="key-codes.html">Key Codes</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2023, Haiku, Inc..
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>